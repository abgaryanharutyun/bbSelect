!function(e){function t(e,t){var i=e.data("bbdropdown"),s=e.find(".bb-selected"),l=s.siblings(".bb-selected-value"),d=(e.find(".bb-options"),s.siblings(".bb-pointer"),e.find(".bb-option").eq(t)),a=d.closest("li"),b=i.settings,c=i.settings.data[t];e.find(".bb-option").removeClass("bb-option-selected"),d.addClass("bb-option-selected"),i.selectedIndex=t,i.selectedItem=a,i.selectedData=c,s.html(b.showSelectedHTML?b.selectedShowOnlyImage?c.selectedImage?c.selectedImage:c.imageSrc?'<img class="bb-selected-image'+("right"==b.imagePosition?" bb-image-right":"")+'" src="'+c.imageSrc+'" />':"":(c.selectedImage?c.selectedImage:c.imageSrc?'<img class="bb-selected-image'+("right"==b.imagePosition?" bb-image-right":"")+'" src="'+c.imageSrc+'" />':"")+(c.text?'<label class="bb-selected-text">'+c.text+"</label>":"")+(c.description?'<small class="bb-selected-description bb-desc'+(b.truncateDescription?" bb-selected-description-truncated":"")+'" >'+c.description+"</small>":""):c.text),l.val(c.value),i.original.val(c.value),e.data("bbdropdown",i),o(e),n(e),"function"==typeof b.onSelected&&b.onSelected.call(this,i)}function i(t){var i=t.find(".bb-select"),o=i.siblings(".bb-options"),n=i.find(".bb-pointer"),l=o.is(":visible");e(".bb-click-off-close").not(o).slideUp(50),e(".bb-pointer").removeClass("bb-pointer-up"),l?(o.slideUp("fast"),n.removeClass("bb-pointer-up")):(o.slideDown("fast"),n.addClass("bb-pointer-up")),s(t)}function o(e){e.find(".bb-options").slideUp(50),e.find(".bb-pointer").removeClass("bb-pointer-up").removeClass("bb-pointer-up")}function n(e){var t=e.find(".bb-select").css("height"),i=e.find(".bb-selected-description"),o=e.find(".bb-selected-image");i.length<=0&&o.length>0&&e.find(".bb-selected-text").css("lineHeight",t)}function s(t){t.find(".bb-option").each(function(){var i=e(this),o=i.css("height"),n=i.find(".bb-option-description"),s=t.find(".bb-option-image");n.length<=0&&s.length>0&&i.find(".bb-option-text").css("lineHeight",o)})}e.fn.bbdropdown=function(t){return l[t]?l[t].apply(this,Array.prototype.dropdown.call(arguments,1)):"object"!=typeof t&&t?void e.error("Method "+t+" does not exists."):l.init.apply(this,arguments)};var l={},d={data:[],keepJSONItemsOnTop:!1,width:260,height:null,background:"#eee",selectText:"",defaultSelectedIndex:null,truncateDescription:!0,imagePosition:"left",showSelectedHTML:!0,clickOffToClose:!0,selectedShowOnlyImage:!1,bbSelectedWidth:300,bbSelectOptionWidth:300,onSelected:function(){}},a='<div class="bb-select"><input class="bb-selected-value" type="hidden" /><a class="bb-selected"></a><span class="bb-pointer bb-pointer-down"></span></div>',b='<ul class="bb-options"></ul>',c='<style id="css-bbdropdown" type="text/css">.bb-select{ border-radius:2px; float:left; border:solid 1px #ccc; position:relative; cursor:pointer;}.bb-desc { color:#aaa; display:block; overflow: hidden; font-weight:normal; line-height: 1.4em; }.bb-selected{ overflow:hidden; display:block; padding:10px; font-weight:bold;}.bb-pointer{ width:0; height:0; position:absolute; right:10px; top:50%; margin-top:-3px;}.bb-pointer-down{ border:solid 5px transparent; border-top:solid 5px #000; }.bb-pointer-up{border:solid 5px transparent !important; border-bottom:solid 5px #000 !important; margin-top:-8px;}.bb-options{ border:solid 1px #ccc; border-top:none; list-style:none; box-shadow:0px 1px 5px #bbd; display:none; position:absolute; z-index:2000; margin:0; padding:0;background:#fff; overflow:auto;}.bb-option{ padding:10px; text-align:left; display:block; border-bottom:solid 1px #bbd; overflow:hidden; text-decoration:none; color:#333; cursor:pointer;-webkit-transition: all 0.25s ease-in-out; -moz-transition: all 0.25s ease-in-out;-o-transition: all 0.25s ease-in-out;-ms-transition: all 0.25s ease-in-out; }.bb-options > li:last-child > .bb-option{ border-bottom:none;}.bb-option:hover{ background:#f3f3f3; color:#000;}.bb-selected-description-truncated { text-overflow: ellipsis; white-space:nowrap; }.bb-option-selected { background:#f6f6f6; }.bb-option-image, .bb-selected-image { vertical-align:mibble; float:left; margin-right:5px; max-width:64px;}.bb-image-right { float:right; margin-right:15px; margin-left:5px;}.bb-container{ position:relative;}​ .bb-selected-text { font-weight:bold}​</style>';e("#css-bbdropdown").length<=0&&e(c).appendTo("head"),l.init=function(o){var o=e.extend({},d,o);return this.each(function(){var n=e(this),s=n.data("bbdropdown");if(!s){{var l=[];o.data}n.find("option").each(function(){var t=e(this),i=t.data();l.push({text:e.trim(t.text()),value:t.val(),selected:t.is(":selected"),description:i.description,imageSrc:i.imagesrc})}),o.keepJSONItemsOnTop?e.merge(o.data,l):o.data=e.merge(l,o.data);var d=n,c=e('<div id="'+n.attr("id")+'"></div>');n.replaceWith(c),n=c,n.addClass("bb-container").append(a).append(b);var l=n.find(".bb-select"),r=n.find(".bb-options");r.css({width:o.bbSelectOptionWidth}),l.css({width:o.bbSelectWidth,background:o.background}),n.css({width:o.width}),null!=o.height&&r.css({height:o.height,overflow:"auto"}),e.each(o.data,function(e,t){t.selected&&(o.defaultSelectedIndex=e),r.append('<li><a class="bb-option">'+(t.value?' <input class="bb-option-value" type="hidden" value="'+t.value+'" />':"")+(t.imageClass?t.imageClass:t.imageSrc?' <img class="bb-option-image'+("right"==o.imagePosition?" bb-image-right":"")+'" src="'+t.imageSrc+'" />':"")+(t.text?' <label class="bb-option-text">'+t.text+"</label>":"")+(t.description?' <small class="bb-option-description bb-desc">'+t.description+"</small>":"")+"</a></li>")});var p={settings:o,original:d,selectedIndex:-1,selectedItem:null,selectedData:null};if(n.data("bbdropdown",p),o.selectText.length>0&&null==o.defaultSelectedIndex)n.find(".bb-selected").html(o.selectText);else{var f=null!=o.defaultSelectedIndex&&o.defaultSelectedIndex>=0&&o.defaultSelectedIndex<o.data.length?o.defaultSelectedIndex:0;t(n,f)}n.find(".bb-select").on("click.bbdropdown",function(){i(n)}),n.find(".bb-option").on("click.bbdropdown",function(){t(n,e(this).closest("li").index())}),o.clickOffToClose&&(r.addClass("bb-click-off-close"),n.on("click.bbdropdown",function(e){e.stopPropagation()}),e("body").on("click",function(){e(".bb-click-off-close").slideUp(50).siblings(".bb-select").find(".bb-pointer").removeClass("bb-pointer-up")}))}})},l.select=function(i){return this.each(function(){i.index&&t(e(this),i.index)})},l.open=function(){return this.each(function(){var t=e(this),o=t.data("bbdropdown");o&&i(t)})},l.close=function(){return this.each(function(){var t=e(this),i=t.data("bbdropdown");i&&o(t)})},l.destroy=function(){return this.each(function(){var t=e(this),i=t.data("bbdropdown");if(i){var o=i.original;t.removeData("bbdropdown").unbind(".bbdropdown").replaceWith(o)}})}}(jQuery);